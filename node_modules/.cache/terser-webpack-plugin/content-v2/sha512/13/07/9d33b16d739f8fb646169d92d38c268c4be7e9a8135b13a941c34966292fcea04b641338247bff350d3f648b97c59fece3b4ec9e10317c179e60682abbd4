{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[134],{491:function(t,a,s){\"use strict\";s.r(a);var n=s(42),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":t.$parent.slotKey}},[s(\"h2\",{attrs:{id:\"springcloud-分布式链路追踪-sleuth\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#springcloud-分布式链路追踪-sleuth\"}},[t._v(\"#\")]),t._v(\" SpringCloud 分布式链路追踪 Sleuth\")]),t._v(\" \"),s(\"h3\",{attrs:{id:\"sleuth-是什么\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#sleuth-是什么\"}},[t._v(\"#\")]),t._v(\" Sleuth 是什么\")]),t._v(\" \"),s(\"ul\",[s(\"li\",[t._v(\"Spring Cloud Sleuth 提供了一套完整的服务跟踪解决方案，在分布式系统中提供追踪解决方案并兼容zipkin\")])]),t._v(\" \"),s(\"h3\",{attrs:{id:\"sleuth-解决什么问题\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#sleuth-解决什么问题\"}},[t._v(\"#\")]),t._v(\" Sleuth 解决什么问题\")]),t._v(\" \"),s(\"ul\",[s(\"li\",[s(\"p\",[t._v(\"在微服务架构中，一个由客户端发起的请求在后端系统中会经过多个不同的服务端的调用来协同产生最后的请求结果，每一个前段的请求都会形成一条复杂的分布式调用链路，链路中任何一个环节出现了高延时或者请求都会导致整个请求失败。\")])]),t._v(\" \"),s(\"li\",[s(\"p\",[t._v(\"我们在微服务架构里面，我们有必要知道，一个流程走了多少步，走过了多少节点，每一步的耗时情况。Sleuth出现就是解决这个问题。\")])])]),t._v(\" \"),s(\"h3\",{attrs:{id:\"sleuth的zipkin搭建安装\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#sleuth的zipkin搭建安装\"}},[t._v(\"#\")]),t._v(\" Sleuth的zipkin搭建安装\")]),t._v(\" \"),s(\"ul\",[s(\"li\",[s(\"p\",[t._v(\"zipkin下载安装\")]),t._v(\" \"),s(\"ul\",[s(\"li\",[t._v(\"spring cloud F版之后不需要  构建zipkin Server了，只需要下载jar 运行\")]),t._v(\" \"),s(\"li\",[t._v(\"下载地址： \"),s(\"code\",[t._v(\"https://dl.bintray.com/openzipkin/maven/io/zipkin/java/zipkin-server/\")]),t._v(\"  下载 \"),s(\"code\",[t._v(\"zipkin-server-2.12.9-exec.jar\")])])])]),t._v(\" \"),s(\"li\",[s(\"p\",[t._v(\"java -jar   zipkin-server-2.12.9-exec.jar 运行\")])]),t._v(\" \"),s(\"li\",[s(\"p\",[t._v(\"运行控制台 \"),s(\"code\",[t._v(\"http://localhost:9411/zipkin/\")])])])]),t._v(\" \"),s(\"h3\",{attrs:{id:\"zipkin调用图\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#zipkin调用图\"}},[t._v(\"#\")]),t._v(\" zipkin调用图\")]),t._v(\" \"),s(\"img\",{attrs:{src:t.$withBase(\"/springcloud/6.png\"),alt:\"dock\"}}),t._v(\" \"),s(\"ul\",[s(\"li\",[s(\"p\",[t._v(\"名词解释：\")]),t._v(\" \"),s(\"ul\",[s(\"li\",[t._v(\"Trace: 类似树结构的span集合，表示同一调用链路，存在唯一标识。\")]),t._v(\" \"),s(\"li\",[t._v(\"span: 表示调用链路来源，通俗理解span就是一次请求信息。\")])]),t._v(\" \"),s(\"h3\",{attrs:{id:\"项目演示-一个euraka-一个服务端8001-一个客户端80\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#项目演示-一个euraka-一个服务端8001-一个客户端80\"}},[t._v(\"#\")]),t._v(\" 项目演示（一个euraka,一个服务端8001，一个客户端80）\")]),t._v(\" \"),s(\"h4\",{attrs:{id:\"_8001\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_8001\"}},[t._v(\"#\")]),t._v(\" 8001\")]),t._v(\" \"),s(\"ul\",[s(\"li\",[t._v(\"增加zipkin依赖\")])]),t._v(\" \"),s(\"div\",{staticClass:\"language-xml extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-xml\"}},[s(\"code\",[s(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"\\x3c!--包含seluth和zipkin --\\x3e\")]),t._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[s(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"<\")]),t._v(\"dependency\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\">\")])]),t._v(\"\\n          \"),s(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[s(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"<\")]),t._v(\"groupId\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\">\")])]),t._v(\"org.springframework.cloud\"),s(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[s(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"</\")]),t._v(\"groupId\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\">\")])]),t._v(\"\\n          \"),s(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[s(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"<\")]),t._v(\"artifactId\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\">\")])]),t._v(\"spring-cloud-starter-zipkin\"),s(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[s(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"</\")]),t._v(\"artifactId\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\">\")])]),t._v(\"\\n      \"),s(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[s(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"</\")]),t._v(\"dependency\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\">\")])]),t._v(\"\\n\")])])]),s(\"ul\",[s(\"li\",[t._v(\"yml 增加\")])]),t._v(\" \"),s(\"div\",{staticClass:\"language-yml extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-yml\"}},[s(\"code\",[s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"spring\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"application\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\"\\n  \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"name\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" cloud\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"-\")]),t._v(\"payment\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"-\")]),t._v(\"service\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"zipkin\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\"\\n  \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"base-url\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" http\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\"//localhost\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"9411\")]),t._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"sleuth\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\"\\n  \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"sampler\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\"\\n    \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"probability\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"1\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"#采样样本，0-１之间，1表示全部采样\")]),t._v(\"\\n\")])])]),s(\"ul\",[s(\"li\",[t._v(\"controller\")])]),t._v(\" \"),s(\"div\",{staticClass:\"language-java extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-java\"}},[s(\"code\",[t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token annotation punctuation\"}},[t._v(\"@GetMapping\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v('\"/zipkin\"')]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n  \"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"public\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[t._v(\"CommonResult\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"getZipkin\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n      \"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"return\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"new\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[t._v(\"CommonResult\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v('\"zipkin调用成功！！！\"')]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n  \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\"\\n\")])])]),s(\"h4\",{attrs:{id:\"_80-增加配置如同8001\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_80-增加配置如同8001\"}},[t._v(\"#\")]),t._v(\" 80 增加配置如同8001\")]),t._v(\" \"),s(\"ul\",[s(\"li\",[t._v(\"增加controller\")])]),t._v(\" \"),s(\"div\",{staticClass:\"language-java extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-java\"}},[s(\"code\",[s(\"span\",{pre:!0,attrs:{class:\"token annotation punctuation\"}},[t._v(\"@GetMapping\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v('\"/payment/getZipkin\"')]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n \"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"public\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[t._v(\"CommonResult\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"getZipkin\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n         \"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"return\")]),t._v(\" restTemplate\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"getForObject\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"PAYMENT_URL\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"+\")]),s(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v('\"/zipkin\"')]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),s(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[t._v(\"CommonResult\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"class\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\"\\n\")])])]),s(\"ul\",[s(\"li\",[s(\"p\",[t._v(\"顺序启动eureka、8001、80，调用 \"),s(\"code\",[t._v(\"localhost:8000/consumer/payment/getZipkin\")])])]),t._v(\" \"),s(\"li\",[s(\"p\",[t._v(\"访问 \"),s(\"code\",[t._v(\"http://localhost:9411/zipkin/\")]),t._v(\",可以选择服务，来查看调用情况，查看依赖看链路调用关系等\")])])])])])])}),[],!1,null,null,null);a.default=e.exports}}]);","extractedComments":[]}